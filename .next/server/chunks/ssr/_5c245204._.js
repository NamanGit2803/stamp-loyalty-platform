module.exports=[73140,89099,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(10333);let e=new class{user=null;shopId=null;loading=!1;error=null;signupStep=1;otpModalOpen=!1;otpEmail="";otpPurpose="";otpVerified=!1;otpResolver=null;redirectAfterOtp=null;hydrated=!1;constructor(){(0,d.makeAutoObservable)(this,{},{autoBind:!0})}async loadInitialUser(){try{let a=await fetch("/api/auth/findUser",{method:"GET",credentials:"include"});if(!a.ok)return;let b=await a.json();(0,d.runInAction)(()=>{this.user=b.user,this.shopId=b.user?.shopId??null})}catch(a){console.error("User load failed:",a)}}async userSignup(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/auth/signup/userCreate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(!b.ok)throw Error(c.error);(0,d.runInAction)(()=>{this.user=c.user})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async login(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(!b.ok)throw Error(c.error);(0,d.runInAction)(()=>{this.user=c.user,this.shopId=c.shopId})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async updateProfile(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/shop/user/updateUserDetails",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(b.ok)return(0,d.runInAction)(()=>{this.user=c.user}),"Profile updated successfully!";throw Error(c.error||"Failed to update profile")}catch(a){(0,d.runInAction)(()=>{this.error=a.message})}finally{this.loading=!1}}async logout(){this.loading=!0,this.error=!1;try{await fetch("/api/auth/logout",{method:"POST"}),(0,d.runInAction)(()=>{this.user=null,this.shopId=null}),window.location.href="/login";return}catch(a){(0,d.runInAction)(()=>{this.error=a.message})}finally{this.loading=!1}}async forgotPassword(a){this.error=null;try{let b=await fetch("/api/auth/forgotPassword/sendLink",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(!b.ok)throw Error(c.error)}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}setSignupStep(a){this.signupStep=a}async requestOtp(a,b,c=null){this.loading=!0,this.error=null;try{let e=await fetch("/api/auth/otp/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,purpose:b})}),f=await e.json();if(!e.ok)throw Error(f.error);(0,d.runInAction)(()=>{this.otpEmail=a,this.otpPurpose=b,this.redirectAfterOtp=c,this.otpModalOpen=!0,this.otpVerified=!1})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}waitForOtp(){return new Promise(a=>{this.otpResolver=a})}closeOtp(){this.otpModalOpen=!1,this.error=null}async verifyOtp(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/auth/otp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.otpEmail,code:a,purpose:this.otpPurpose})}),c=await b.json();if(!b.ok)throw Error(c.error);return(0,d.runInAction)(()=>{this.otpVerified=!0,this.otpModalOpen=!1}),this.otpResolver&&(this.otpResolver(!0),this.otpResolver=null),!0}catch(a){return(0,d.runInAction)(()=>this.error=a.message),!1}finally{this.loading=!1}}},f=new class{shop=null;subscription=null;subscriptionStatus="";daysLeft=null;plan=[];dashboardStats=null;loading=!1;error=null;hydrated=!1;customers=[];scanVerifications=[];pagination={page:1,total:0,limit:10,totalPages:1};constructor(){(0,d.makeAutoObservable)(this,{},{autoBind:!0})}async loadInitial(){this.loading=!0;try{let a=await fetch("/api/auth/findShop",{method:"GET",credentials:"include"}),b=await a.json();if(401===a.status||!b.shop)return void(0,d.runInAction)(()=>{this.shop=null,this.subscription=null,this.subscriptionStatus="NONE"});(0,d.runInAction)(()=>{this.shop=b.shop}),await this.loadSubscription()}catch(a){(0,d.runInAction)(()=>{this.error=a.message,this.shop=null,this.subscription=null,this.subscriptionStatus="NONE"})}finally{this.loading=!1}}async loadSubscription(){if(this.shop?.id)try{let a=await fetch("/api/subscription/status",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop.id})}),b=await a.json();if(!a.ok)throw Error(b.error||"Failed to load subscription");(0,d.runInAction)(()=>{this.subscription=b.subscription,this.subscriptionStatus=b.subscription.status||"NONE",this.daysLeft=this.calculateDaysLeft(b.subscription)})}catch(a){(0,d.runInAction)(()=>{this.error=a.message,this.subscription=null,this.subscriptionStatus="NONE",this.daysLeft=null})}}calculateDaysLeft(a){if(!a)return null;let b=new Date,c=a.trialEndsAt?new Date(a.trialEndsAt):null,d=a.nextBillingAt?new Date(a.nextBillingAt):null;if(c&&b>c)return console.log("date hello"),-1;if(d&&b>d)return -1;let e=a=>{let b=new Date(new Date(a).getTime()+198e5);return new Date(b.getFullYear(),b.getMonth(),b.getDate())},f=e(b);if(a.trialEndsAt){let b=Math.floor((e(a.trialEndsAt)-f)/864e5);if(b>=0)return b}if(a.nextBillingAt){let b=Math.floor((e(a.nextBillingAt)-f)/864e5);return b>=0?b:-1}return -1}async fetchDashboardStats(){this.error=null,this.loading=!0;try{let a=await fetch("/api/shop/dashboardStats",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop?.id})}),b=await a.json();(0,d.runInAction)(()=>{this.dashboardStats=b})}catch(a){(0,d.runInAction)(()=>this.error=err.message)}finally{this.loading=!1}}async createShop(a,b){this.loading=!0,this.error=null;try{let c=await fetch("/api/auth/signup/shopCreate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),e=await c.json();if(!c.ok)throw Error(e.error);(0,d.runInAction)(()=>{this.shop=e.newShop}),await this.startTrial(b)}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async startTrial(a){if(this.shop){this.loading=!0,this.error=null;try{let b=await fetch("/api/subscription/start",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop.id,planId:a})}),c=await b.json();if(409===b.status&&!0==b.subscription)return void(0,d.runInAction)(()=>this.error=c.error);if(!b.ok)throw Error(c.error);await this.loadSubscription()}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}}resetPagination(){this.pagination={page:1,total:0,limit:10,totalPages:1}}updatePagination(a){this.pagination={page:a.page,total:a.total,limit:a.limit,totalPages:a.totalPages}}async fetchCustomers({page:a,search:b=""}){this.loading=!1,this.error=null;try{let c=await fetch("/api/shop/customers/fetchAllCustomer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop?.id,page:a,limit:this.pagination.limit,search:b})}),e=await c.json();if(!c.ok)throw Error(e.error);(0,d.runInAction)(()=>{this.customers=e.data,this.pagination=e.pagination})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async redeemReward(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/shop/customers/rewardRedeem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:a,shopId:this.shop?.id,requiredStamps:this.shop?.targetStamps,rewardText:this.shop?.reward})}),c=await b.json();if(!b.ok)throw Error(c.error);await this.fetchCustomers({page:this.pagination.page})}catch(a){return this.error=a.message,{error:a.message}}finally{this.loading=!1}}async fetchPaymentVerifications({page:a,search:b,date:c,status:e}){this.loading=!1,this.error=null;try{let g=await fetch("/api/shop/paymentVerification/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:f.shop?.id,page:a,limit:f.pagination?.limit,search:b,date:c,status:e})}),h=await g.json();if(!g.ok)throw Error(h.error||"Failed to fetch rewards");(0,d.runInAction)(()=>{this.scanVerifications=h.data,this.pagination=h.pagination})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async verifyScan(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/shop/paymentVerification/manualVerify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop?.id,scanId:a})}),c=await b.json();if(!b.ok)throw Error(c.error);await this.fetchPaymentVerifications({page:this.pagination.page,search:"",status:"all"})}catch(a){return this.error=a.message,{error:a.message}}finally{this.loading=!1}}async updateShopDetails(a,b=!1){this.loading=!0,this.error=null;try{let c=await fetch("/api/shop/shopDetails/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:f.shop?.id,details:a,enable:b})}),e=await c.json();if(!c.ok)throw Error(e.error||"Failed to update.");(0,d.runInAction)(()=>this.shop=e.shop);return}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async activeSubscription(){this.loading=!0,this.error=null;try{let a=await fetch("/api/subscription/extend",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop?.id})}),b=await a.json();if(!a.ok)throw Error(b.error)}catch(a){return this.error=a.message,{error:a.message}}finally{this.loading=!1}}};a.s(["shopStore",0,f],89099);let g={userStore:e,shopStore:f,planStore:new class{plans=[];selectedPlan=null;loading=!1;error=null;hydrated=!1;constructor(){(0,d.makeAutoObservable)(this,{},{autoBind:!0})}async loadPlans(){this.loading=!0,this.error=null;try{let a=await fetch("/api/plans/fetchPlans",{method:"GET",credentials:"include"}),b=await a.json();if(!b.success)throw Error(b.message||"Failed to load plans");(0,d.runInAction)(()=>{this.plans=b.plans||[],this.selectedPlan=b.plans?.[0]||null})}catch(a){(0,d.runInAction)(()=>{this.error=a.message,this.plans=[],this.selectedPlan=null})}finally{this.loading=!1}}selectPlan(a){let b=this.plans.find(b=>b.id===a);this.selectedPlan=b||null}getPlanById(a){return this.plans.find(b=>b.id===a)}get defaultPlan(){return this.plans?.[0]||null}}},h=(0,c.createContext)(g);a.s(["StoreProvider",0,({children:a})=>(0,b.jsx)(h.Provider,{value:g,children:a}),"useStore",0,()=>(0,c.useContext)(h)],73140)},5522,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,type:d,...e}){return(0,b.jsx)("input",{type:d,"data-slot":"input",className:(0,c.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),...e})}a.s(["Input",()=>d])},62213,a=>{"use strict";let b=(0,a.i(70106).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);a.s(["default",()=>b])},97942,a=>{"use strict";var b=a.i(72131),c=a.i(7554),d=a.i(70121),e=a.i(50104),f=a.i(92843),g=a.i(25152),h=a.i(96743),i=a.i(22297),j=a.i(92616),k=a.i(77192),l=a.i(30553),m=a.i(86228),n=a.i(52081),o=a.i(41852),p=a.i(11011),q=a.i(87924),r="Dialog",[s,t]=(0,e.createContextScope)(r),[u,v]=s(r),w=a=>{let{__scopeDialog:c,children:d,open:e,defaultOpen:h,onOpenChange:i,modal:j=!0}=a,k=b.useRef(null),l=b.useRef(null),[m=!1,n]=(0,g.useControllableState)({prop:e,defaultProp:h,onChange:i});return(0,q.jsx)(u,{scope:c,triggerRef:k,contentRef:l,contentId:(0,f.useId)(),titleId:(0,f.useId)(),descriptionId:(0,f.useId)(),open:m,onOpenChange:n,onOpenToggle:b.useCallback(()=>n(a=>!a),[n]),modal:j,children:d})};w.displayName=r;var x="DialogTrigger",y=b.forwardRef((a,b)=>{let{__scopeDialog:e,...f}=a,g=v(x,e),h=(0,d.useComposedRefs)(b,g.triggerRef);return(0,q.jsx)(l.Primitive.button,{type:"button","aria-haspopup":"dialog","aria-expanded":g.open,"aria-controls":g.contentId,"data-state":R(g.open),...f,ref:h,onClick:(0,c.composeEventHandlers)(a.onClick,g.onOpenToggle)})});y.displayName=x;var z="DialogPortal",[A,B]=s(z,{forceMount:void 0}),C=a=>{let{__scopeDialog:c,forceMount:d,children:e,container:f}=a,g=v(z,c);return(0,q.jsx)(A,{scope:c,forceMount:d,children:b.Children.map(e,a=>(0,q.jsx)(k.Presence,{present:d||g.open,children:(0,q.jsx)(j.Portal,{asChild:!0,container:f,children:a})}))})};C.displayName=z;var D="DialogOverlay",E=b.forwardRef((a,b)=>{let c=B(D,a.__scopeDialog),{forceMount:d=c.forceMount,...e}=a,f=v(D,a.__scopeDialog);return f.modal?(0,q.jsx)(k.Presence,{present:d||f.open,children:(0,q.jsx)(F,{...e,ref:b})}):null});E.displayName=D;var F=b.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=v(D,c);return(0,q.jsx)(n.RemoveScroll,{as:p.Slot,allowPinchZoom:!0,shards:[e.contentRef],children:(0,q.jsx)(l.Primitive.div,{"data-state":R(e.open),...d,ref:b,style:{pointerEvents:"auto",...d.style}})})}),G="DialogContent",H=b.forwardRef((a,b)=>{let c=B(G,a.__scopeDialog),{forceMount:d=c.forceMount,...e}=a,f=v(G,a.__scopeDialog);return(0,q.jsx)(k.Presence,{present:d||f.open,children:f.modal?(0,q.jsx)(I,{...e,ref:b}):(0,q.jsx)(J,{...e,ref:b})})});H.displayName=G;var I=b.forwardRef((a,e)=>{let f=v(G,a.__scopeDialog),g=b.useRef(null),h=(0,d.useComposedRefs)(e,f.contentRef,g);return b.useEffect(()=>{let a=g.current;if(a)return(0,o.hideOthers)(a)},[]),(0,q.jsx)(K,{...a,ref:h,trapFocus:f.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,c.composeEventHandlers)(a.onCloseAutoFocus,a=>{a.preventDefault(),f.triggerRef.current?.focus()}),onPointerDownOutside:(0,c.composeEventHandlers)(a.onPointerDownOutside,a=>{let b=a.detail.originalEvent,c=0===b.button&&!0===b.ctrlKey;(2===b.button||c)&&a.preventDefault()}),onFocusOutside:(0,c.composeEventHandlers)(a.onFocusOutside,a=>a.preventDefault())})}),J=b.forwardRef((a,c)=>{let d=v(G,a.__scopeDialog),e=b.useRef(!1),f=b.useRef(!1);return(0,q.jsx)(K,{...a,ref:c,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:b=>{a.onCloseAutoFocus?.(b),b.defaultPrevented||(e.current||d.triggerRef.current?.focus(),b.preventDefault()),e.current=!1,f.current=!1},onInteractOutside:b=>{a.onInteractOutside?.(b),b.defaultPrevented||(e.current=!0,"pointerdown"===b.detail.originalEvent.type&&(f.current=!0));let c=b.target;d.triggerRef.current?.contains(c)&&b.preventDefault(),"focusin"===b.detail.originalEvent.type&&f.current&&b.preventDefault()}})}),K=b.forwardRef((a,c)=>{let{__scopeDialog:e,trapFocus:f,onOpenAutoFocus:g,onCloseAutoFocus:j,...k}=a,l=v(G,e),n=b.useRef(null),o=(0,d.useComposedRefs)(c,n);return(0,m.useFocusGuards)(),(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(i.FocusScope,{asChild:!0,loop:!0,trapped:f,onMountAutoFocus:g,onUnmountAutoFocus:j,children:(0,q.jsx)(h.DismissableLayer,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":R(l.open),...k,ref:o,onDismiss:()=>l.onOpenChange(!1)})}),(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(V,{titleId:l.titleId}),(0,q.jsx)(W,{contentRef:n,descriptionId:l.descriptionId})]})]})}),L="DialogTitle",M=b.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=v(L,c);return(0,q.jsx)(l.Primitive.h2,{id:e.titleId,...d,ref:b})});M.displayName=L;var N="DialogDescription",O=b.forwardRef((a,b)=>{let{__scopeDialog:c,...d}=a,e=v(N,c);return(0,q.jsx)(l.Primitive.p,{id:e.descriptionId,...d,ref:b})});O.displayName=N;var P="DialogClose",Q=b.forwardRef((a,b)=>{let{__scopeDialog:d,...e}=a,f=v(P,d);return(0,q.jsx)(l.Primitive.button,{type:"button",...e,ref:b,onClick:(0,c.composeEventHandlers)(a.onClick,()=>f.onOpenChange(!1))})});function R(a){return a?"open":"closed"}Q.displayName=P;var S="DialogTitleWarning",[T,U]=(0,e.createContext)(S,{contentName:G,titleName:L,docsSlug:"dialog"}),V=({titleId:a})=>{let c=U(S),d=`\`${c.contentName}\` requires a \`${c.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${c.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${c.docsSlug}`;return b.useEffect(()=>{a&&(document.getElementById(a)||console.error(d))},[d,a]),null},W=({contentRef:a,descriptionId:c})=>{let d=U("DialogDescriptionWarning"),e=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${d.contentName}}.`;return b.useEffect(()=>{let b=a.current?.getAttribute("aria-describedby");c&&b&&(document.getElementById(c)||console.warn(e))},[e,a,c]),null};a.s(["Close",()=>Q,"Content",()=>H,"Description",()=>O,"Overlay",()=>E,"Portal",()=>C,"Root",()=>w,"Title",()=>M,"Trigger",()=>y,"WarningProvider",()=>T,"createDialogScope",()=>t])}];

//# sourceMappingURL=_5c245204._.js.map