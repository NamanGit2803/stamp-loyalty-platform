module.exports=[73140,89099,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(10333);let e=new class{user=null;shopId=null;loading=!1;error=null;signupStep=1;otpModalOpen=!1;otpEmail="";otpPurpose="";otpVerified=!1;otpResolver=null;redirectAfterOtp=null;hydrated=!1;constructor(){(0,d.makeAutoObservable)(this,{},{autoBind:!0})}async loadInitialUser(){try{let a=await fetch("/api/auth/findUser",{method:"GET",credentials:"include"});if(!a.ok)return;let b=await a.json();(0,d.runInAction)(()=>{this.user=b.user,this.shopId=b.user?.shopId??null})}catch(a){console.error("User load failed:",a)}}async userSignup(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/auth/signup/userCreate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(!b.ok)throw Error(c.error);(0,d.runInAction)(()=>{this.user=c.user})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async login(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(!b.ok)throw Error(c.error);(0,d.runInAction)(()=>{this.user=c.user,this.shopId=c.shopId})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async updateProfile(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/shop/user/updateUserDetails",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(b.ok)return(0,d.runInAction)(()=>{this.user=c.user}),"Profile updated successfully!";throw Error(c.error||"Failed to update profile")}catch(a){(0,d.runInAction)(()=>{this.error=a.message})}finally{this.loading=!1}}async logout(){this.loading=!0,this.error=!1;try{await fetch("/api/auth/logout",{method:"POST"}),(0,d.runInAction)(()=>{this.user=null,this.shopId=null}),window.location.href="/login";return}catch(a){(0,d.runInAction)(()=>{this.error=a.message})}finally{this.loading=!1}}async forgotPassword(a){this.error=null;try{let b=await fetch("/api/auth/forgotPassword/sendLink",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),c=await b.json();if(!b.ok)throw Error(c.error)}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}setSignupStep(a){this.signupStep=a}async requestOtp(a,b,c=null){this.loading=!0,this.error=null;try{let e=await fetch("/api/auth/otp/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,purpose:b})}),f=await e.json();if(!e.ok)throw Error(f.error);(0,d.runInAction)(()=>{this.otpEmail=a,this.otpPurpose=b,this.redirectAfterOtp=c,this.otpModalOpen=!0,this.otpVerified=!1})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}waitForOtp(){return new Promise(a=>{this.otpResolver=a})}closeOtp(){this.otpModalOpen=!1,this.error=null}async verifyOtp(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/auth/otp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:this.otpEmail,code:a,purpose:this.otpPurpose})}),c=await b.json();if(!b.ok)throw Error(c.error);return(0,d.runInAction)(()=>{this.otpVerified=!0,this.otpModalOpen=!1}),this.otpResolver&&(this.otpResolver(!0),this.otpResolver=null),!0}catch(a){return(0,d.runInAction)(()=>this.error=a.message),!1}finally{this.loading=!1}}},f=new class{shop=null;subscription=null;subscriptionStatus="";daysLeft=null;plan=[];loading=!1;error=null;hydrated=!1;customers=[];scanVerifications=[];pagination={page:1,total:0,limit:10,totalPages:1};constructor(){(0,d.makeAutoObservable)(this,{},{autoBind:!0})}async loadInitial(){this.loading=!0;try{let a=await fetch("/api/auth/findShop",{method:"GET",credentials:"include"}),b=await a.json();if(401===a.status||!b.shop)return void(0,d.runInAction)(()=>{this.shop=null,this.subscription=null,this.subscriptionStatus="NONE"});(0,d.runInAction)(()=>{this.shop=b.shop}),await this.loadSubscription()}catch(a){(0,d.runInAction)(()=>{this.error=a.message,this.shop=null,this.subscription=null,this.subscriptionStatus="NONE"})}finally{this.loading=!1}}async loadSubscription(){if(this.shop?.id)try{let a=await fetch("/api/subscription/status",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop.id})}),b=await a.json();if(!a.ok)throw Error(b.error||"Failed to load subscription");(0,d.runInAction)(()=>{this.subscription=b.subscription,this.subscriptionStatus=b.subscription.status||"NONE",this.daysLeft=this.calculateDaysLeft(b.subscription)})}catch(a){(0,d.runInAction)(()=>{this.error=a.message,this.subscription=null,this.subscriptionStatus="NONE",this.daysLeft=null})}}calculateDaysLeft(a){if(!a)return null;let b=a=>{let b=new Date(a),c=new Date(b.getTime()+6e4*b.getTimezoneOffset()+198e5);return new Date(c.getFullYear(),c.getMonth(),c.getDate())},c=new Date,d=new Date(c.getTime()+6e4*c.getTimezoneOffset()+198e5),e=new Date(d.getFullYear(),d.getMonth(),d.getDate());if(a.trialEndsAt){let c=Math.floor((b(a.trialEndsAt)-e)/864e5);if(c>=0)return c}if(a.nextBillingAt){let c=Math.floor((b(a.nextBillingAt)-e)/864e5);return c>0?c:0}return 0}async createShop(a,b){this.loading=!0,this.error=null;try{let c=await fetch("/api/auth/signup/shopCreate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),e=await c.json();if(!c.ok)throw Error(e.error);(0,d.runInAction)(()=>{this.shop=e.newShop}),await this.startTrial(b)}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async startTrial(a){if(this.shop){this.loading=!0,this.error=null;try{let b=await fetch("/api/subscription/start",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop.id,planId:a})}),c=await b.json();if(409===b.status&&!0==b.subscription)return void(0,d.runInAction)(()=>this.error=c.error);if(!b.ok)throw Error(c.error);await this.loadSubscription()}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}}resetPagination(){this.pagination={page:1,total:0,limit:10,totalPages:1}}updatePagination(a){this.pagination={page:a.page,total:a.total,limit:a.limit,totalPages:a.totalPages}}async fetchCustomers({page:a,search:b=""}){this.loading=!1,this.error=null;try{let c=await fetch("/api/shop/customers/fetchAllCustomer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop?.id,page:a,limit:this.pagination.limit,search:b})}),e=await c.json();if(!c.ok)throw Error(e.error);(0,d.runInAction)(()=>{this.customers=e.data,this.pagination=e.pagination})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async redeemReward(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/shop/customers/rewardRedeem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:a,shopId:this.shop?.id,requiredStamps:this.shop?.targetStamps,rewardText:this.shop?.reward})}),c=await b.json();if(!b.ok)throw Error(c.error);await this.fetchCustomers({page:this.pagination.page})}catch(a){return this.error=a.message,{error:a.message}}finally{this.loading=!1}}async fetchPaymentVerifications({page:a,search:b,date:c,status:e}){this.loading=!1,this.error=null;try{let g=await fetch("/api/shop/paymentVerification/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:f.shop?.id,page:a,limit:f.pagination?.limit,search:b,date:c,status:e})}),h=await g.json();if(!g.ok)throw Error(h.error||"Failed to fetch rewards");(0,d.runInAction)(()=>{this.scanVerifications=h.data,this.pagination=h.pagination})}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async verifyScan(a){this.loading=!0,this.error=null;try{let b=await fetch("/api/shop/paymentVerification/manualVerify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop?.id,scanId:a})}),c=await b.json();if(!b.ok)throw Error(c.error);await this.fetchPaymentVerifications({page:this.pagination.page,search:"",status:"all"})}catch(a){return this.error=a.message,{error:a.message}}finally{this.loading=!1}}async updateShopDetails(a,b=!1){this.loading=!0,this.error=null;try{let c=await fetch("/api/shop/shopDetails/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:f.shop?.id,details:a,enable:b})}),e=await c.json();if(!c.ok)throw Error(e.error||"Failed to update.");(0,d.runInAction)(()=>this.shop=e.shop);return}catch(a){(0,d.runInAction)(()=>this.error=a.message)}finally{this.loading=!1}}async activeSubscription(){this.loading=!0,this.error=null;try{let a=await fetch("/api/subscription/extend",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shopId:this.shop?.id})}),b=await a.json();if(!a.ok)throw Error(b.error)}catch(a){return this.error=a.message,{error:a.message}}finally{this.loading=!1}}};a.s(["shopStore",0,f],89099);let g={userStore:e,shopStore:f,planStore:new class{plans=[];selectedPlan=null;loading=!1;error=null;hydrated=!1;constructor(){(0,d.makeAutoObservable)(this,{},{autoBind:!0})}async loadPlans(){this.loading=!0,this.error=null;try{let a=await fetch("/api/plans/fetchPlans",{method:"GET",credentials:"include"}),b=await a.json();if(!b.success)throw Error(b.message||"Failed to load plans");(0,d.runInAction)(()=>{this.plans=b.plans||[],this.selectedPlan=b.plans?.[0]||null})}catch(a){(0,d.runInAction)(()=>{this.error=a.message,this.plans=[],this.selectedPlan=null})}finally{this.loading=!1}}selectPlan(a){let b=this.plans.find(b=>b.id===a);this.selectedPlan=b||null}getPlanById(a){return this.plans.find(b=>b.id===a)}get defaultPlan(){return this.plans?.[0]||null}}},h=(0,c.createContext)(g);a.s(["StoreProvider",0,({children:a})=>(0,b.jsx)(h.Provider,{value:g,children:a}),"useStore",0,()=>(0,c.useContext)(h)],73140)},5522,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,type:d,...e}){return(0,b.jsx)("input",{type:d,"data-slot":"input",className:(0,c.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",a),...e})}a.s(["Input",()=>d])},96743,92616,a=>{"use strict";var b,c=a.i(72131),d=a.i(7554),e=a.i(30553),f=a.i(70121),g=a.i(46872),h=a.i(87924),i="dismissableLayer.update",j=c.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),k=c.forwardRef((a,k)=>{let{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:o,onPointerDownOutside:p,onFocusOutside:q,onInteractOutside:r,onDismiss:s,...t}=a,u=c.useContext(j),[v,w]=c.useState(null),x=v?.ownerDocument??globalThis?.document,[,y]=c.useState({}),z=(0,f.useComposedRefs)(k,a=>w(a)),A=Array.from(u.layers),[B]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),C=A.indexOf(B),D=v?A.indexOf(v):-1,E=u.layersWithOutsidePointerEventsDisabled.size>0,F=D>=C,G=function(a,b=globalThis?.document){let d=(0,g.useCallbackRef)(a),e=c.useRef(!1),f=c.useRef(()=>{});return c.useEffect(()=>{let a=a=>{if(a.target&&!e.current){let c=function(){m("dismissableLayer.pointerDownOutside",d,e,{discrete:!0})},e={originalEvent:a};"touch"===a.pointerType?(b.removeEventListener("click",f.current),f.current=c,b.addEventListener("click",f.current,{once:!0})):c()}else b.removeEventListener("click",f.current);e.current=!1},c=window.setTimeout(()=>{b.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(c),b.removeEventListener("pointerdown",a),b.removeEventListener("click",f.current)}},[b,d]),{onPointerDownCapture:()=>e.current=!0}}(a=>{let b=a.target,c=[...u.branches].some(a=>a.contains(b));F&&!c&&(p?.(a),r?.(a),a.defaultPrevented||s?.())},x),H=function(a,b=globalThis?.document){let d=(0,g.useCallbackRef)(a),e=c.useRef(!1);return c.useEffect(()=>{let a=a=>{a.target&&!e.current&&m("dismissableLayer.focusOutside",d,{originalEvent:a},{discrete:!1})};return b.addEventListener("focusin",a),()=>b.removeEventListener("focusin",a)},[b,d]),{onFocusCapture:()=>e.current=!0,onBlurCapture:()=>e.current=!1}}(a=>{let b=a.target;![...u.branches].some(a=>a.contains(b))&&(q?.(a),r?.(a),a.defaultPrevented||s?.())},x);return!function(a,b=globalThis?.document){let d=(0,g.useCallbackRef)(a);c.useEffect(()=>{let a=a=>{"Escape"===a.key&&d(a)};return b.addEventListener("keydown",a,{capture:!0}),()=>b.removeEventListener("keydown",a,{capture:!0})},[d,b])}(a=>{D===u.layers.size-1&&(o?.(a),!a.defaultPrevented&&s&&(a.preventDefault(),s()))},x),c.useEffect(()=>{if(v)return n&&(0===u.layersWithOutsidePointerEventsDisabled.size&&(b=x.body.style.pointerEvents,x.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(v)),u.layers.add(v),l(),()=>{n&&1===u.layersWithOutsidePointerEventsDisabled.size&&(x.body.style.pointerEvents=b)}},[v,x,n,u]),c.useEffect(()=>()=>{v&&(u.layers.delete(v),u.layersWithOutsidePointerEventsDisabled.delete(v),l())},[v,u]),c.useEffect(()=>{let a=()=>y({});return document.addEventListener(i,a),()=>document.removeEventListener(i,a)},[]),(0,h.jsx)(e.Primitive.div,{...t,ref:z,style:{pointerEvents:E?F?"auto":"none":void 0,...a.style},onFocusCapture:(0,d.composeEventHandlers)(a.onFocusCapture,H.onFocusCapture),onBlurCapture:(0,d.composeEventHandlers)(a.onBlurCapture,H.onBlurCapture),onPointerDownCapture:(0,d.composeEventHandlers)(a.onPointerDownCapture,G.onPointerDownCapture)})});function l(){let a=new CustomEvent(i);document.dispatchEvent(a)}function m(a,b,c,{discrete:d}){let f=c.originalEvent.target,g=new CustomEvent(a,{bubbles:!1,cancelable:!0,detail:c});b&&f.addEventListener(a,b,{once:!0}),d?(0,e.dispatchDiscreteCustomEvent)(f,g):f.dispatchEvent(g)}k.displayName="DismissableLayer",c.forwardRef((a,b)=>{let d=c.useContext(j),g=c.useRef(null),i=(0,f.useComposedRefs)(b,g);return c.useEffect(()=>{let a=g.current;if(a)return d.branches.add(a),()=>{d.branches.delete(a)}},[d.branches]),(0,h.jsx)(e.Primitive.div,{...a,ref:i})}).displayName="DismissableLayerBranch",a.s(["DismissableLayer",()=>k],96743);var n=a.i(35112),o=a.i(72752),p=c.forwardRef((a,b)=>{let{container:d,...f}=a,[g,i]=c.useState(!1);(0,o.useLayoutEffect)(()=>i(!0),[]);let j=d||g&&globalThis?.document?.body;return j?n.default.createPortal((0,h.jsx)(e.Primitive.div,{...f,ref:b}),j):null});p.displayName="Portal",a.s(["Portal",()=>p],92616)}];

//# sourceMappingURL=_cd6381e9._.js.map