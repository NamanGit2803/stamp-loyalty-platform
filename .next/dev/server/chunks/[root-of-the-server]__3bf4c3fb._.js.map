{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/resend.js"],"sourcesContent":["import { Resend } from \"resend\";\r\n\r\nexport const resend = new Resend(process.env.RESEND_API_KEY);\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,SAAS,IAAI,oJAAM,CAAC,QAAQ,GAAG,CAAC,cAAc"}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/sendEmail.js"],"sourcesContent":["import { resend } from \"./resend\";\r\n\r\nexport async function sendEmail({ to, subject, html }) {\r\n  try {\r\n    return await resend.emails.send({\r\n      from: \"Stampi <no-reply@stampi.in>\",\r\n      to,\r\n      subject,\r\n      html,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Email error:\", error);\r\n    throw error;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,eAAe,UAAU,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE;IACnD,IAAI;QACF,OAAO,MAAM,yHAAM,CAAC,MAAM,CAAC,IAAI,CAAC;YAC9B,MAAM;YACN;YACA;YACA;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,MAAM;IACR;AACF"}},
    {"offset": {"line": 128, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/templates/baseEmail.js"],"sourcesContent":["export function baseEmailTemplate({ title, content }) {\r\n    return `\r\n  <!DOCTYPE html>\r\n  <html>\r\n    <body style=\"margin:0;font-family:Arial;background:#f6f9fc;padding:20px\">\r\n      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n        <tr>\r\n          <td align=\"center\">\r\n            <table width=\"600\" style=\"background:#ffffff;border-radius:8px;padding:24px\">\r\n              <tr>\r\n                <td style=\"text-align:center;font-size:24px;font-weight:bold;color:#6247AA\">\r\n                  Stampi\r\n                </td>\r\n              </tr>\r\n\r\n              <tr><td style=\"padding:20px 0;font-size:18px;font-weight:bold\">\r\n                ${title}\r\n              </td></tr>\r\n\r\n              <tr><td style=\"font-size:15px;color:#444\">\r\n                ${content}\r\n              </td></tr>\r\n\r\n              <tr><td style=\"padding-top:30px;font-size:12px;color:#999;text-align:center\">\r\n                © ${new Date().getFullYear()} Stampi · All rights reserved\r\n              </td></tr>\r\n            </table>\r\n          </td>\r\n        </tr>\r\n      </table>\r\n    </body>\r\n  </html>\r\n  `;\r\n}\r\n"],"names":[],"mappings":";;;;AAAO,SAAS,kBAAkB,EAAE,KAAK,EAAE,OAAO,EAAE;IAChD,OAAO,CAAC;;;;;;;;;;;;;;;gBAeI,EAAE,MAAM;;;;gBAIR,EAAE,QAAQ;;;;kBAIR,EAAE,IAAI,OAAO,WAAW,GAAG;;;;;;;;EAQ3C,CAAC;AACH"}},
    {"offset": {"line": 170, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/templates/resetPasswordEmail.js"],"sourcesContent":["import { baseEmailTemplate } from \"./baseEmail\";\r\n\r\nexport function ResetPasswordEmailTemplate({ resetLink }) {\r\n    return baseEmailTemplate({\r\n        title: \"Reset Your Password\",\r\n        content: `\r\n      <p>We received a request to reset your Stampi account password.</p>\r\n\r\n      <p>Click the button below to reset it:</p>\r\n\r\n      <a href=\"${resetLink}\"\r\n         style=\"\r\n          display:inline-block;\r\n          padding:12px 24px;\r\n          background:#c9a7ff;\r\n          color:#000;\r\n          border-radius:8px;\r\n          text-decoration:none;\r\n          font-weight:600;\r\n          margin:20px 0;\r\n        \">\r\n        Reset Password\r\n      </a>\r\n\r\n      <p>If you didn't request this, you can safely ignore this email.</p>\r\n    `,\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,2BAA2B,EAAE,SAAS,EAAE;IACpD,OAAO,IAAA,oJAAiB,EAAC;QACrB,OAAO;QACP,SAAS,CAAC;;;;;eAKH,EAAE,UAAU;;;;;;;;;;;;;;;IAevB,CAAC;IACD;AACJ"}},
    {"offset": {"line": 206, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/email/sendResetPasswordEmail.js"],"sourcesContent":["import { sendEmail } from \"../sendEmail\";\r\nimport { ResetPasswordEmailTemplate } from \"../templates/resetPasswordEmail\";\r\n\r\nexport async function SendResetPasswordEmail({ email, resetLink }) {\r\n  try {\r\n    return await sendEmail({\r\n      to: email,\r\n      subject: \"Reset Your Stampi Password\",\r\n      html: ResetPasswordEmailTemplate({ resetLink }),\r\n    });\r\n  } catch (error) {\r\n    console.error(\"[Reset Password Email Error]:\", error);\r\n    throw error;\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,uBAAuB,EAAE,KAAK,EAAE,SAAS,EAAE;IAC/D,IAAI;QACF,OAAO,MAAM,IAAA,+HAAS,EAAC;YACrB,IAAI;YACJ,SAAS;YACT,MAAM,IAAA,sKAA0B,EAAC;gBAAE;YAAU;QAC/C;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,MAAM;IACR;AACF"}},
    {"offset": {"line": 232, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/app/api/auth/forgotPassword/sendLink/route.js"],"sourcesContent":["export const dynamic = \"force-dynamic\";\r\nexport const runtime = \"nodejs\";\r\n\r\nimport { NextResponse } from \"next/server\";\r\nimport { SendResetPasswordEmail } from \"@/lib/email/sendResetPasswordEmail\";\r\nimport crypto from \"crypto\";\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        // ✅ Lazy import Prisma (build-safe)\r\n        const { default: prisma } = await import(\"@/lib/prisma\");\r\n\r\n        const email = await req.json();\r\n\r\n        // ✅ Validation\r\n        if (!email) {\r\n            return NextResponse.json(\r\n                { error: \"Email is required\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // ✅ Find user (do NOT expose result)\r\n        const user = await prisma.user.findUnique({\r\n            where: { email },\r\n        });\r\n\r\n        if (user) {\r\n            // ✅ Generate secure token\r\n            const token = crypto.randomBytes(32).toString(\"hex\");\r\n            const tokenHash = crypto\r\n                .createHash(\"sha256\")\r\n                .update(token)\r\n                .digest(\"hex\");\r\n\r\n            const expiresAt = new Date(Date.now() + 15 * 60 * 1000); // 15 min\r\n\r\n            // ✅ Remove old tokens for same email\r\n            await prisma.passwordReset.deleteMany({\r\n                where: { userId: email },\r\n            });\r\n\r\n            // ✅ Store new token\r\n            await prisma.passwordReset.create({\r\n                data: {\r\n                    userId: email,\r\n                    tokenHash,\r\n                    expiresAt,\r\n                },\r\n            });\r\n\r\n            console.log('token', token)\r\n\r\n            // ✅ Reset URL (email integration later)\r\n            const resetUrl = `${process.env.NEXT_PUBLIC_APP_URL}/reset-password?token=${token}`;\r\n\r\n            await SendResetPasswordEmail({\r\n                email,\r\n                resetLink: resetUrl,\r\n            });\r\n\r\n        }\r\n\r\n        // ✅ Always return same response (security)\r\n        return NextResponse.json(\r\n            {\r\n                success: true,\r\n            },\r\n            { status: 200 }\r\n        );\r\n\r\n    } catch (err) {\r\n        console.error(\"[forgot password error]\", err);\r\n        return NextResponse.json(\r\n            { error: \"Server error\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAGA;AACA;AACA;AALO,MAAM,UAAU;AAChB,MAAM,UAAU;;;;AAMhB,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,oCAAoC;QACpC,MAAM,EAAE,SAAS,MAAM,EAAE,GAAG;QAE5B,MAAM,QAAQ,MAAM,IAAI,IAAI;QAE5B,eAAe;QACf,IAAI,CAAC,OAAO;YACR,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,qCAAqC;QACrC,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE;YAAM;QACnB;QAEA,IAAI,MAAM;YACN,0BAA0B;YAC1B,MAAM,QAAQ,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;YAC9C,MAAM,YAAY,gHAAM,CACnB,UAAU,CAAC,UACX,MAAM,CAAC,OACP,MAAM,CAAC;YAEZ,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,OAAO,SAAS;YAElE,qCAAqC;YACrC,MAAM,OAAO,aAAa,CAAC,UAAU,CAAC;gBAClC,OAAO;oBAAE,QAAQ;gBAAM;YAC3B;YAEA,oBAAoB;YACpB,MAAM,OAAO,aAAa,CAAC,MAAM,CAAC;gBAC9B,MAAM;oBACF,QAAQ;oBACR;oBACA;gBACJ;YACJ;YAEA,QAAQ,GAAG,CAAC,SAAS;YAErB,wCAAwC;YACxC,MAAM,WAAW,yDAAmC,sBAAsB,EAAE,OAAO;YAEnF,MAAM,IAAA,kKAAsB,EAAC;gBACzB;gBACA,WAAW;YACf;QAEJ;QAEA,2CAA2C;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,SAAS;QACb,GACA;YAAE,QAAQ;QAAI;IAGtB,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAe,GACxB;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}