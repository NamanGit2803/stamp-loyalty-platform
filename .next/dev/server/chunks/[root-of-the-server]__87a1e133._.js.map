{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/prisma.js"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = globalThis;\r\n\r\nconst prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({ log: [\"error\"] });\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  globalForPrisma.prisma = prisma;\r\n}\r\n\r\nexport default prisma;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAExB,MAAM,SACJ,gBAAgB,MAAM,IACtB,IAAI,6IAAY,CAAC;IAAE,KAAK;QAAC;KAAQ;AAAC;AAEpC,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B;uCAEe"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/app/api/auth/login/route.js"],"sourcesContent":["export const dynamic = \"force-dynamic\";\r\nexport const runtime = \"nodejs\";\r\n\r\nimport { NextResponse } from \"next/server\";\r\nimport prisma from \"@/lib/prisma\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        const body = await req.json();\r\n        const { email, password } = body;\r\n\r\n        // ✅ same validation\r\n        if (!email || !password) {\r\n            return NextResponse.json(\r\n                { error: \"Email and password are required\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // ✅ same user lookup\r\n        const user = await prisma.user.findUnique({\r\n            where: { email },\r\n        });\r\n\r\n        if (!user) {\r\n            return NextResponse.json(\r\n                { error: \"User not found. Please sign up.\" },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // ✅ same shop lookup\r\n        const shop = await prisma.shop.findFirst({\r\n            where: { ownerId: user.email },\r\n        });\r\n\r\n        if (!shop) {\r\n            return NextResponse.json(\r\n                { error: \"Shop not registered.\" },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // ✅ same password check\r\n        const isMatch = await bcrypt.compare(password, user.password);\r\n        if (!isMatch) {\r\n            return NextResponse.json(\r\n                { error: \"Incorrect password\" },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // ✅ env guard\r\n        if (!process.env.JWT_SECRET) {\r\n            return NextResponse.json(\r\n                { error: \"Server misconfiguration\" },\r\n                { status: 500 }\r\n            );\r\n        }\r\n\r\n        // ✅ runtime-only JWT import\r\n        const jwt = (await import(\"jsonwebtoken\")).default;\r\n\r\n        // ✅ same token payload & expiry\r\n        const token = jwt.sign(\r\n            { email: user.email, name: user.name, role: user.role },\r\n            process.env.JWT_SECRET,\r\n            { expiresIn: \"7d\" }\r\n        );\r\n\r\n        const response = NextResponse.json(\r\n            {\r\n                success: true,\r\n                user,\r\n                shopId: shop.id,\r\n            },\r\n            { status: 201 }\r\n        );\r\n\r\n        // ✅ cookies are SYNC (no await)\r\n        response.cookies.set(\"token\", token, {\r\n            httpOnly: true,\r\n            secure: process.env.NODE_ENV === \"production\" && !!process.env.VERCEL,\r\n            sameSite: \"strict\",\r\n            maxAge: 7 * 24 * 60 * 60,\r\n            path: \"/\",\r\n        });\r\n\r\n        return response;\r\n\r\n    } catch (err) {\r\n        console.error(\"[login error]\", err);\r\n        return NextResponse.json(\r\n            { error: \"Server error\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAGA;AACA;AACA;AALO,MAAM,UAAU;AAChB,MAAM,UAAU;;;;AAMhB,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAE5B,oBAAoB;QACpB,IAAI,CAAC,SAAS,CAAC,UAAU;YACrB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAEtB;QAEA,qBAAqB;QACrB,MAAM,OAAO,MAAM,0HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE;YAAM;QACnB;QAEA,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAEtB;QAEA,qBAAqB;QACrB,MAAM,OAAO,MAAM,0HAAM,CAAC,IAAI,CAAC,SAAS,CAAC;YACrC,OAAO;gBAAE,SAAS,KAAK,KAAK;YAAC;QACjC;QAEA,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,wBAAwB;QACxB,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;QAC5D,IAAI,CAAC,SAAS;YACV,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,cAAc;QACd,IAAI,CAAC,QAAQ,GAAG,CAAC,UAAU,EAAE;YACzB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAEtB;QAEA,4BAA4B;QAC5B,MAAM,MAAM,CAAC,oHAA4B,EAAE,OAAO;QAElD,gCAAgC;QAChC,MAAM,QAAQ,IAAI,IAAI,CAClB;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;YAAE,MAAM,KAAK,IAAI;QAAC,GACtD,QAAQ,GAAG,CAAC,UAAU,EACtB;YAAE,WAAW;QAAK;QAGtB,MAAM,WAAW,gJAAY,CAAC,IAAI,CAC9B;YACI,SAAS;YACT;YACA,QAAQ,KAAK,EAAE;QACnB,GACA;YAAE,QAAQ;QAAI;QAGlB,gCAAgC;QAChC,SAAS,OAAO,CAAC,GAAG,CAAC,SAAS,OAAO;YACjC,UAAU;YACV,QAAQ,oDAAyB,gBAAgB,CAAC,CAAC,QAAQ,GAAG,CAAC,MAAM;YACrE,UAAU;YACV,QAAQ,IAAI,KAAK,KAAK;YACtB,MAAM;QACV;QAEA,OAAO;IAEX,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAe,GACxB;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}