{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/awsSes.js"],"sourcesContent":["import { SESClient } from \"@aws-sdk/client-ses\";\r\n\r\nexport const sesClient = new SESClient({\r\n  region: process.env.AWS_REGION,\r\n  credentials: {\r\n    accessKeyId: process.env.AWS_ACCESS_KEY_ID,\r\n    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,\r\n  },\r\n});\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,MAAM,YAAY,IAAI,uMAAS,CAAC;IACrC,QAAQ,QAAQ,GAAG,CAAC,UAAU;IAC9B,aAAa;QACX,aAAa,QAAQ,GAAG,CAAC,iBAAiB;QAC1C,iBAAiB,QAAQ,GAAG,CAAC,qBAAqB;IACpD;AACF"}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/sendEmail.js"],"sourcesContent":["import { SendEmailCommand } from \"@aws-sdk/client-ses\";\r\nimport { sesClient } from \"./awsSes\";\r\n\r\nexport async function sendEmail({ to, subject, text, html }) {\r\n    const command = new SendEmailCommand({\r\n        Source: `Stampi <${process.env.SES_FROM_EMAIL}>`,\r\n        ReplyToAddresses: [\"support@stampi.in\"], // ðŸ‘ˆ important\r\n        Destination: {\r\n            ToAddresses: [to],\r\n        },\r\n        Message: {\r\n            Subject: { Data: subject, Charset: \"UTF-8\" },\r\n            Body: {\r\n                ...(html\r\n                    ? { Html: { Data: html, Charset: \"UTF-8\" } }\r\n                    : { Text: { Data: text, Charset: \"UTF-8\" } }),\r\n            },\r\n        },\r\n    });\r\n\r\n    return sesClient.send(command);\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,UAAU,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE;IACvD,MAAM,UAAU,IAAI,iOAAgB,CAAC;QACjC,QAAQ,CAAC,QAAQ,EAAE,QAAQ,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;QAChD,kBAAkB;YAAC;SAAoB;QACvC,aAAa;YACT,aAAa;gBAAC;aAAG;QACrB;QACA,SAAS;YACL,SAAS;gBAAE,MAAM;gBAAS,SAAS;YAAQ;YAC3C,MAAM;gBACF,GAAI,OACE;oBAAE,MAAM;wBAAE,MAAM;wBAAM,SAAS;oBAAQ;gBAAE,IACzC;oBAAE,MAAM;wBAAE,MAAM;wBAAM,SAAS;oBAAQ;gBAAE,CAAC;YACpD;QACJ;IACJ;IAEA,OAAO,4HAAS,CAAC,IAAI,CAAC;AAC1B"}},
    {"offset": {"line": 168, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/templates/baseEmail.js"],"sourcesContent":["export function baseEmailTemplate({ title, content }) {\r\n    return `\r\n  <!DOCTYPE html>\r\n  <html>\r\n    <body style=\"margin:0;font-family:Arial;background:#f6f9fc;padding:20px\">\r\n      <table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\">\r\n        <tr>\r\n          <td align=\"center\">\r\n            <table width=\"600\" style=\"background:#ffffff;border-radius:8px;padding:24px\">\r\n              <tr>\r\n                <td style=\"text-align:center;font-size:24px;font-weight:bold;color:#6247AA\">\r\n                  Stampi\r\n                </td>\r\n              </tr>\r\n\r\n              <tr><td style=\"padding:20px 0;font-size:18px;font-weight:bold\">\r\n                ${title}\r\n              </td></tr>\r\n\r\n              <tr><td style=\"font-size:15px;color:#444\">\r\n                ${content}\r\n              </td></tr>\r\n\r\n              <tr><td style=\"padding-top:30px;font-size:12px;color:#999;text-align:center\">\r\n                Â© ${new Date().getFullYear()} Stampi Â· All rights reserved\r\n              </td></tr>\r\n            </table>\r\n          </td>\r\n        </tr>\r\n      </table>\r\n    </body>\r\n  </html>\r\n  `;\r\n}\r\n"],"names":[],"mappings":";;;;AAAO,SAAS,kBAAkB,EAAE,KAAK,EAAE,OAAO,EAAE;IAChD,OAAO,CAAC;;;;;;;;;;;;;;;gBAeI,EAAE,MAAM;;;;gBAIR,EAAE,QAAQ;;;;kBAIR,EAAE,IAAI,OAAO,WAAW,GAAG;;;;;;;;EAQ3C,CAAC;AACH"}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/templates/resetPasswordEmail.js"],"sourcesContent":["import { baseEmailTemplate } from \"./baseEmail\";\r\n\r\nexport function ResetPasswordEmailTemplate({ resetLink }) {\r\n    return baseEmailTemplate({\r\n        title: \"Reset Your Password\",\r\n        content: `\r\n      <p>We received a request to reset your Stampi account password.</p>\r\n\r\n      <p>Click the button below to reset it:</p>\r\n\r\n      <a href=\"${resetLink}\"\r\n         style=\"\r\n          display:inline-block;\r\n          padding:12px 24px;\r\n          background:#c9a7ff;\r\n          color:#000;\r\n          border-radius:8px;\r\n          text-decoration:none;\r\n          font-weight:600;\r\n          margin:20px 0;\r\n        \">\r\n        Reset Password\r\n      </a>\r\n\r\n      <p>If you didn't request this, you can safely ignore this email.</p>\r\n    `,\r\n    });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,2BAA2B,EAAE,SAAS,EAAE;IACpD,OAAO,IAAA,oJAAiB,EAAC;QACrB,OAAO;QACP,SAAS,CAAC;;;;;eAKH,EAAE,UAAU;;;;;;;;;;;;;;;IAevB,CAAC;IACD;AACJ"}},
    {"offset": {"line": 246, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/lib/email/sendResetPasswordEmail.js"],"sourcesContent":["import { sendEmail } from \"../sendEmail\";\r\nimport { ResetPasswordEmailTemplate } from \"../templates/resetPasswordEmail\";\r\n\r\nexport async function SendResetPasswordEmail({email, resetLink}) {\r\n\r\n  const html = ResetPasswordEmailTemplate({ resetLink });\r\n\r\n  await sendEmail({\r\n    to: email,\r\n    subject: \"Reset Your Stampi Password\",\r\n    html\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,uBAAuB,EAAC,KAAK,EAAE,SAAS,EAAC;IAE7D,MAAM,OAAO,IAAA,sKAA0B,EAAC;QAAE;IAAU;IAEpD,MAAM,IAAA,+HAAS,EAAC;QACd,IAAI;QACJ,SAAS;QACT;IACF;AACF"}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/app/api/auth/forgotPassword/sendLink/route.js"],"sourcesContent":["export const dynamic = \"force-dynamic\";\r\nexport const runtime = \"nodejs\";\r\n\r\nimport { NextResponse } from \"next/server\";\r\nimport { SendResetPasswordEmail } from \"@/lib/email/sendResetPasswordEmail\";\r\nimport crypto from \"crypto\";\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        // âœ… Lazy import Prisma (build-safe)\r\n        const { default: prisma } = await import(\"@/lib/prisma\");\r\n\r\n        const email = await req.json();\r\n\r\n        // âœ… Validation\r\n        if (!email) {\r\n            return NextResponse.json(\r\n                { error: \"Email is required\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // âœ… Find user (do NOT expose result)\r\n        const user = await prisma.user.findUnique({\r\n            where: { email },\r\n        });\r\n\r\n        if (user) {\r\n            // âœ… Generate secure token\r\n            const token = crypto.randomBytes(32).toString(\"hex\");\r\n            const tokenHash = crypto\r\n                .createHash(\"sha256\")\r\n                .update(token)\r\n                .digest(\"hex\");\r\n\r\n            const expiresAt = new Date(Date.now() + 15 * 60 * 1000); // 15 min\r\n\r\n            // âœ… Remove old tokens for same email\r\n            await prisma.passwordReset.deleteMany({\r\n                where: { userId: email },\r\n            });\r\n\r\n            // âœ… Store new token\r\n            await prisma.passwordReset.create({\r\n                data: {\r\n                    userId: email,\r\n                    tokenHash,\r\n                    expiresAt,\r\n                },\r\n            });\r\n\r\n            console.log('token', token)\r\n\r\n            // âœ… Reset URL (email integration later)\r\n            const resetUrl = `${process.env.NEXT_PUBLIC_APP_URL}/reset-password?token=${token}`;\r\n\r\n            await SendResetPasswordEmail({\r\n                email,\r\n                resetLink: resetUrl,\r\n            });\r\n\r\n        }\r\n\r\n        // âœ… Always return same response (security)\r\n        return NextResponse.json(\r\n            {\r\n                success: true,\r\n            },\r\n            { status: 200 }\r\n        );\r\n\r\n    } catch (err) {\r\n        console.error(\"[forgot password error]\", err);\r\n        return NextResponse.json(\r\n            { error: \"Server error\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAGA;AACA;AACA;AALO,MAAM,UAAU;AAChB,MAAM,UAAU;;;;AAMhB,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,oCAAoC;QACpC,MAAM,EAAE,SAAS,MAAM,EAAE,GAAG;QAE5B,MAAM,QAAQ,MAAM,IAAI,IAAI;QAE5B,eAAe;QACf,IAAI,CAAC,OAAO;YACR,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,qCAAqC;QACrC,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE;YAAM;QACnB;QAEA,IAAI,MAAM;YACN,0BAA0B;YAC1B,MAAM,QAAQ,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;YAC9C,MAAM,YAAY,gHAAM,CACnB,UAAU,CAAC,UACX,MAAM,CAAC,OACP,MAAM,CAAC;YAEZ,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,OAAO,SAAS;YAElE,qCAAqC;YACrC,MAAM,OAAO,aAAa,CAAC,UAAU,CAAC;gBAClC,OAAO;oBAAE,QAAQ;gBAAM;YAC3B;YAEA,oBAAoB;YACpB,MAAM,OAAO,aAAa,CAAC,MAAM,CAAC;gBAC9B,MAAM;oBACF,QAAQ;oBACR;oBACA;gBACJ;YACJ;YAEA,QAAQ,GAAG,CAAC,SAAS;YAErB,wCAAwC;YACxC,MAAM,WAAW,yDAAmC,sBAAsB,EAAE,OAAO;YAEnF,MAAM,IAAA,kKAAsB,EAAC;gBACzB;gBACA,WAAW;YACf;QAEJ;QAEA,2CAA2C;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,SAAS;QACb,GACA;YAAE,QAAQ;QAAI;IAGtB,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAe,GACxB;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}