{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/app/api/auth/forgotPassword/sendLink/route.js"],"sourcesContent":["export const dynamic = \"force-dynamic\";\r\nexport const runtime = \"nodejs\";\r\n\r\nimport { NextResponse } from \"next/server\";\r\nimport crypto from \"crypto\";\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        // ✅ Lazy import Prisma (build-safe)\r\n        const { default: prisma } = await import(\"@/lib/prisma\");\r\n\r\n        const email = await req.json();\r\n\r\n        // ✅ Validation\r\n        if (!email) {\r\n            return NextResponse.json(\r\n                { error: \"Email is required\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // ✅ Find user (do NOT expose result)\r\n        const user = await prisma.user.findUnique({\r\n            where: { email },\r\n        });\r\n\r\n        if (user) {\r\n            // ✅ Generate secure token\r\n            const token = crypto.randomBytes(32).toString(\"hex\");\r\n            const tokenHash = crypto\r\n                .createHash(\"sha256\")\r\n                .update(token)\r\n                .digest(\"hex\");\r\n\r\n            const expiresAt = new Date(Date.now() + 15 * 60 * 1000); // 15 min\r\n\r\n            // ✅ Remove old tokens for same email\r\n            await prisma.passwordReset.deleteMany({\r\n                where: { userId: email },\r\n            });\r\n\r\n            // ✅ Store new token\r\n            await prisma.passwordReset.create({\r\n                data: {\r\n                    userId: email,\r\n                    tokenHash,\r\n                    expiresAt,\r\n                },\r\n            });\r\n\r\n            // ✅ Reset URL (email integration later)\r\n            const resetUrl = `${process.env.NEXT_PUBLIC_APP_URL}/reset-password?token=${token}`;\r\n\r\n            console.log(\"[FORGOT PASSWORD] Reset URL:\", resetUrl);\r\n\r\n            /*\r\n            await sendResetPasswordEmail({\r\n                to: email,\r\n                name: user.name,\r\n                resetUrl,\r\n            });\r\n            */\r\n        }\r\n\r\n        // ✅ Always return same response (security)\r\n        return NextResponse.json(\r\n            {\r\n                success: true,\r\n            },\r\n            { status: 200 }\r\n        );\r\n\r\n    } catch (err) {\r\n        console.error(\"[forgot password error]\", err);\r\n        return NextResponse.json(\r\n            { error: \"Server error\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAGA;AACA;AAJO,MAAM,UAAU;AAChB,MAAM,UAAU;;;AAKhB,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,oCAAoC;QACpC,MAAM,EAAE,SAAS,MAAM,EAAE,GAAG;QAE5B,MAAM,QAAQ,MAAM,IAAI,IAAI;QAE5B,eAAe;QACf,IAAI,CAAC,OAAO;YACR,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAoB,GAC7B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,qCAAqC;QACrC,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE;YAAM;QACnB;QAEA,IAAI,MAAM;YACN,0BAA0B;YAC1B,MAAM,QAAQ,gHAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC;YAC9C,MAAM,YAAY,gHAAM,CACnB,UAAU,CAAC,UACX,MAAM,CAAC,OACP,MAAM,CAAC;YAEZ,MAAM,YAAY,IAAI,KAAK,KAAK,GAAG,KAAK,KAAK,KAAK,OAAO,SAAS;YAElE,qCAAqC;YACrC,MAAM,OAAO,aAAa,CAAC,UAAU,CAAC;gBAClC,OAAO;oBAAE,QAAQ;gBAAM;YAC3B;YAEA,oBAAoB;YACpB,MAAM,OAAO,aAAa,CAAC,MAAM,CAAC;gBAC9B,MAAM;oBACF,QAAQ;oBACR;oBACA;gBACJ;YACJ;YAEA,wCAAwC;YACxC,MAAM,WAAW,6DAAmC,sBAAsB,EAAE,OAAO;YAEnF,QAAQ,GAAG,CAAC,gCAAgC;QAE5C;;;;;;YAMA,GACJ;QAEA,2CAA2C;QAC3C,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,SAAS;QACb,GACA;YAAE,QAAQ;QAAI;IAGtB,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAe,GACxB;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}