{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/app/api/auth/login/route.js"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\"\r\nimport bcrypt from \"bcryptjs\"\r\nimport jwt from \"jsonwebtoken\"\r\nimport { NextResponse } from \"next/server\"\r\n\r\nconst prisma = new PrismaClient()\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        const body = await req.json()\r\n        const { email, password } = body\r\n\r\n        // check for email & password \r\n        if (!email || !password) {\r\n            return NextResponse.json(\r\n                { error: \"Email and password are required\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        // Check if user exists\r\n        const user = await prisma.user.findUnique({ where: { email } })\r\n        if (!user) {\r\n            return NextResponse.json(\r\n                { error: \"User not found. Please sign up.\" },\r\n                { status: 401 }\r\n            )\r\n        }\r\n\r\n\r\n        // finding shop with this email\r\n        const shop = await prisma.shop.findFirst({\r\n            where: { ownerId: user.email }\r\n        });\r\n        if (!shop) {\r\n            return NextResponse.json(\r\n                { error: \"Shop not registered.\" },\r\n                { status: 401 }\r\n            )\r\n        }\r\n\r\n\r\n        // password match \r\n        const isMatch = await bcrypt.compare(password, user.password);\r\n        if (!isMatch) {\r\n            return NextResponse.json(\r\n                { error: \"Incorrect password\" },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        // token create \r\n        const token = jwt.sign(\r\n            { email: user.email, name: user.name, role: user.role },\r\n            process.env.JWT_SECRET,\r\n            { expiresIn: \"7d\" }\r\n        )\r\n\r\n\r\n\r\n        const response = NextResponse.json(\r\n            { success: true, user: user, shopId: shop.id},\r\n            { status: 201 }\r\n        )\r\n\r\n        response.cookies.set(\"token\", token, {\r\n            httpOnly: true,\r\n            secure: process.env.NODE_ENV === \"production\",\r\n            sameSite: \"strict\",\r\n            maxAge: 7 * 24 * 60 * 60,\r\n            path: \"/\",\r\n        })\r\n\r\n        return response\r\n    } catch (err) {\r\n        console.error(err)\r\n        return NextResponse.json({ error: \"Server error\" }, { status: 500 })\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAExB,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG;QAE5B,8BAA8B;QAC9B,IAAI,CAAC,SAAS,CAAC,UAAU;YACrB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAEtB;QAEA,uBAAuB;QACvB,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,UAAU,CAAC;YAAE,OAAO;gBAAE;YAAM;QAAE;QAC7D,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAEtB;QAGA,+BAA+B;QAC/B,MAAM,OAAO,MAAM,OAAO,IAAI,CAAC,SAAS,CAAC;YACrC,OAAO;gBAAE,SAAS,KAAK,KAAK;YAAC;QACjC;QACA,IAAI,CAAC,MAAM;YACP,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAuB,GAChC;gBAAE,QAAQ;YAAI;QAEtB;QAGA,kBAAkB;QAClB,MAAM,UAAU,MAAM,8IAAM,CAAC,OAAO,CAAC,UAAU,KAAK,QAAQ;QAC5D,IAAI,CAAC,SAAS;YACV,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,gBAAgB;QAChB,MAAM,QAAQ,kJAAG,CAAC,IAAI,CAClB;YAAE,OAAO,KAAK,KAAK;YAAE,MAAM,KAAK,IAAI;YAAE,MAAM,KAAK,IAAI;QAAC,GACtD,QAAQ,GAAG,CAAC,UAAU,EACtB;YAAE,WAAW;QAAK;QAKtB,MAAM,WAAW,gJAAY,CAAC,IAAI,CAC9B;YAAE,SAAS;YAAM,MAAM;YAAM,QAAQ,KAAK,EAAE;QAAA,GAC5C;YAAE,QAAQ;QAAI;QAGlB,SAAS,OAAO,CAAC,GAAG,CAAC,SAAS,OAAO;YACjC,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ,IAAI,KAAK,KAAK;YACtB,MAAM;QACV;QAEA,OAAO;IACX,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACtE;AACJ"}}]
}