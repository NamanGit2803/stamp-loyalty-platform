{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/app/api/shop/customers/rewardHistory/route.js"],"sourcesContent":["export const dynamic = \"force-dynamic\";\r\nexport const runtime = \"nodejs\";\r\n\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        const { default: prisma } = await import(\"@/lib/prisma\");\r\n\r\n        const body = await req.json();\r\n        const {\r\n            shopId,\r\n            page = 1,\r\n            limit = 10,\r\n            search = \"\",\r\n            date = \"\"\r\n        } = body;\r\n\r\n        if (!shopId) {\r\n            return NextResponse.json(\r\n                { error: \"shopId\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const skip = (page - 1) * limit;\r\n\r\n        // WHERE FILTER\r\n        const where = {\r\n            shopId,\r\n            AND: []\r\n        };\r\n\r\n        // SEARCH â†’ customer.name / customer.phone\r\n        if (search) {\r\n            where.AND.push({\r\n                customer: {\r\n                    OR: [\r\n                        { name: { contains: search} },\r\n                        { phone: { contains: search } }\r\n                    ]\r\n                }\r\n            });\r\n        }\r\n\r\n        // DATE FILTER\r\n        if (date) {\r\n            where.AND.push({\r\n                createdAt: {\r\n                    gte: new Date(date + \"T00:00:00\"),\r\n                    lte: new Date(date + \"T23:59:59\")\r\n                }\r\n            });\r\n        }\r\n\r\n        // FETCH DATA\r\n        const rewards = await prisma.reward.findMany({\r\n            where,\r\n            skip,\r\n            take: limit,\r\n            orderBy: { createdAt: \"desc\" },\r\n            include: {\r\n                customer: true // so we can show name/phone in table\r\n            }\r\n        });\r\n\r\n        // TOTAL COUNT\r\n        const total = await prisma.reward.count({ where });\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            data: rewards,\r\n            pagination: {\r\n                page,\r\n                limit,\r\n                total,\r\n                totalPages: Math.ceil(total / limit)\r\n            }\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(\"Rewards API error:\", err);\r\n        return NextResponse.json(\r\n            { error: \"Server Error\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAGA;AAHO,MAAM,UAAU;AAChB,MAAM,UAAU;;AAIhB,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,MAAM,EAAE,SAAS,MAAM,EAAE,GAAG;QAE5B,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EACF,MAAM,EACN,OAAO,CAAC,EACR,QAAQ,EAAE,EACV,SAAS,EAAE,EACX,OAAO,EAAE,EACZ,GAAG;QAEJ,IAAI,CAAC,QAAQ;YACT,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAS,GAClB;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI;QAE1B,eAAe;QACf,MAAM,QAAQ;YACV;YACA,KAAK,EAAE;QACX;QAEA,0CAA0C;QAC1C,IAAI,QAAQ;YACR,MAAM,GAAG,CAAC,IAAI,CAAC;gBACX,UAAU;oBACN,IAAI;wBACA;4BAAE,MAAM;gCAAE,UAAU;4BAAM;wBAAE;wBAC5B;4BAAE,OAAO;gCAAE,UAAU;4BAAO;wBAAE;qBACjC;gBACL;YACJ;QACJ;QAEA,cAAc;QACd,IAAI,MAAM;YACN,MAAM,GAAG,CAAC,IAAI,CAAC;gBACX,WAAW;oBACP,KAAK,IAAI,KAAK,OAAO;oBACrB,KAAK,IAAI,KAAK,OAAO;gBACzB;YACJ;QACJ;QAEA,aAAa;QACb,MAAM,UAAU,MAAM,OAAO,MAAM,CAAC,QAAQ,CAAC;YACzC;YACA;YACA,MAAM;YACN,SAAS;gBAAE,WAAW;YAAO;YAC7B,SAAS;gBACL,UAAU,KAAK,qCAAqC;YACxD;QACJ;QAEA,cAAc;QACd,MAAM,QAAQ,MAAM,OAAO,MAAM,CAAC,KAAK,CAAC;YAAE;QAAM;QAEhD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,MAAM;YACN,YAAY;gBACR;gBACA;gBACA;gBACA,YAAY,KAAK,IAAI,CAAC,QAAQ;YAClC;QACJ;IAEJ,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,sBAAsB;QACpC,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAe,GACxB;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}