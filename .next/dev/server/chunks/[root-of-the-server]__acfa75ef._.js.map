{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///E:/Project%20Files/Earning-model/stamp-card-project/stamp-loyalty-platform/app/api/shop/paymentVerification/fetch/route.js"],"sourcesContent":["export const dynamic = \"force-dynamic\";\r\nexport const runtime = \"nodejs\";\r\n\r\nimport { NextResponse } from \"next/server\";\r\n\r\nexport async function POST(req) {\r\n    try {\r\n        const { default: prisma } = await import(\"@/lib/prisma\");\r\n\r\n        const body = await req.json();\r\n        const {\r\n            shopId,\r\n            page = 1,\r\n            limit = 10,\r\n            search = \"\",\r\n            date = \"\",\r\n            status = \"all\"\r\n        } = body;\r\n\r\n        if (!shopId) {\r\n            return NextResponse.json(\r\n                { error: \"shopId is required\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const skip = (page - 1) * limit;\r\n\r\n        // -------------------------\r\n        // BUILD WHERE CONDITION\r\n        // -------------------------\r\n\r\n        const where = { shopId };\r\n\r\n        // Status filter\r\n        if (status !== \"all\") {\r\n            where.status = status;\r\n        }\r\n\r\n        // Date filter (full day)\r\n        if (date) {\r\n            const startUTC = new Date(date + \"T00:00:00.000Z\");\r\n            const endUTC = new Date(date + \"T23:59:59.999Z\");\r\n\r\n            where.createdAt = { gte: startUTC, lte: endUTC };\r\n        }\r\n\r\n\r\n        // Search filter\r\n        if (search.trim()) {\r\n            where.OR = [\r\n                { utr: { contains: search } },\r\n                { phone: { contains: search } },\r\n\r\n                // amount search (numeric)\r\n                !isNaN(Number(search))\r\n                    ? { amount: Number(search) }\r\n                    : undefined\r\n            ].filter(Boolean);\r\n        }\r\n\r\n        // -------------------------\r\n        // QUERY DB\r\n        // -------------------------\r\n        const items = await prisma.scanVerification.findMany({\r\n            where,\r\n            skip,\r\n            take: limit,\r\n            orderBy: { createdAt: \"desc\" },\r\n            include: {\r\n                customer: true\r\n            }\r\n        });\r\n\r\n        const total = await prisma.scanVerification.count({\r\n            where,\r\n        });\r\n\r\n        // -------------------------\r\n        // RESPONSE\r\n        // -------------------------\r\n        return NextResponse.json({\r\n            success: true,\r\n            data: items,\r\n            pagination: {\r\n                page,\r\n                limit,\r\n                total,\r\n                totalPages: Math.ceil(total / limit),\r\n            },\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(\"Scan Verification API error:\", err);\r\n        return NextResponse.json(\r\n            { error: \"Server Error\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAGA;AAHO,MAAM,UAAU;AAChB,MAAM,UAAU;;AAIhB,eAAe,KAAK,GAAG;IAC1B,IAAI;QACA,MAAM,EAAE,SAAS,MAAM,EAAE,GAAG;QAE5B,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EACF,MAAM,EACN,OAAO,CAAC,EACR,QAAQ,EAAE,EACV,SAAS,EAAE,EACX,OAAO,EAAE,EACT,SAAS,KAAK,EACjB,GAAG;QAEJ,IAAI,CAAC,QAAQ;YACT,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAEtB;QAEA,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI;QAE1B,4BAA4B;QAC5B,wBAAwB;QACxB,4BAA4B;QAE5B,MAAM,QAAQ;YAAE;QAAO;QAEvB,gBAAgB;QAChB,IAAI,WAAW,OAAO;YAClB,MAAM,MAAM,GAAG;QACnB;QAEA,yBAAyB;QACzB,IAAI,MAAM;YACN,MAAM,WAAW,IAAI,KAAK,OAAO;YACjC,MAAM,SAAS,IAAI,KAAK,OAAO;YAE/B,MAAM,SAAS,GAAG;gBAAE,KAAK;gBAAU,KAAK;YAAO;QACnD;QAGA,gBAAgB;QAChB,IAAI,OAAO,IAAI,IAAI;YACf,MAAM,EAAE,GAAG;gBACP;oBAAE,KAAK;wBAAE,UAAU;oBAAO;gBAAE;gBAC5B;oBAAE,OAAO;wBAAE,UAAU;oBAAO;gBAAE;gBAE9B,0BAA0B;gBAC1B,CAAC,MAAM,OAAO,WACR;oBAAE,QAAQ,OAAO;gBAAQ,IACzB;aACT,CAAC,MAAM,CAAC;QACb;QAEA,4BAA4B;QAC5B,WAAW;QACX,4BAA4B;QAC5B,MAAM,QAAQ,MAAM,OAAO,gBAAgB,CAAC,QAAQ,CAAC;YACjD;YACA;YACA,MAAM;YACN,SAAS;gBAAE,WAAW;YAAO;YAC7B,SAAS;gBACL,UAAU;YACd;QACJ;QAEA,MAAM,QAAQ,MAAM,OAAO,gBAAgB,CAAC,KAAK,CAAC;YAC9C;QACJ;QAEA,4BAA4B;QAC5B,WAAW;QACX,4BAA4B;QAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,MAAM;YACN,YAAY;gBACR;gBACA;gBACA;gBACA,YAAY,KAAK,IAAI,CAAC,QAAQ;YAClC;QACJ;IAEJ,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,OAAO;QAAe,GACxB;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}