{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'stream')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`stream`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'crypto')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`crypto`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/lib/prisma.js"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\n// Prevent multiple instances of Prisma Client in dev mode\r\nconst globalForPrisma = globalThis;\r\n\r\nexport const prisma =\r\n  globalForPrisma.prisma ||\r\n  new PrismaClient({\r\n    log: [\"query\", \"error\", \"warn\"], // optional but helpful\r\n  });\r\n\r\nif (process.env.NODE_ENV !== \"production\") {\r\n  globalForPrisma.prisma = prisma;\r\n}\r\n\r\nexport default prisma;\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEA,0DAA0D;AAC1D,MAAM,kBAAkB;AAEjB,MAAM,SACX,gBAAgB,MAAM,IACtB,IAAI,qKAAY,CAAC;IACf,KAAK;QAAC;QAAS;QAAS;KAAO;AACjC;AAEF,wCAA2C;IACzC,gBAAgB,MAAM,GAAG;AAC3B;uCAEe"}},
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { prisma } from \"@/lib/prisma\"; // adjust path if needed\r\n\r\nexport async function middleware(req) {\r\n  const pathname = req.nextUrl.pathname;\r\n\r\n  // Detect pattern: /shop_xxxxx\r\n  const shopMatch = pathname.match(/^\\/(shop_[A-Za-z0-9]+)/);\r\n  const requestedShopId = shopMatch?.[1] || null;\r\n\r\n  const isAdminRoute = pathname.startsWith(\"/admin\");\r\n  const isShopRoute  = Boolean(requestedShopId);\r\n  const isAdminApi   = pathname.startsWith(\"/api/admin\");\r\n  const isShopApi    = pathname.startsWith(\"/api/shop\");\r\n\r\n  // If route is NOT private → PUBLIC → allow\r\n  const isPrivate = isAdminRoute || isShopRoute || isAdminApi || isShopApi;\r\n  if (!isPrivate) return NextResponse.next();\r\n\r\n  // AUTH CHECK\r\n  const token = req.cookies.get(\"token\")?.value;\r\n  if (!token) return NextResponse.redirect(new URL(\"/auth/login\", req.url));\r\n\r\n  let user;\r\n  try {\r\n    user = jwt.verify(token, process.env.JWT_SECRET);\r\n  } catch {\r\n    return NextResponse.redirect(new URL(\"/auth/login\", req.url));\r\n  }\r\n\r\n  // PROTECT ADMIN AREA\r\n  if (isAdminRoute || isAdminApi) {\r\n    if (user.role !== \"ADMIN\") return NextResponse.redirect(new URL(\"/\", req.url));\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // PROTECT SHOP AREA WITH VALID SHOP ID CHECK\r\n  if (isShopRoute) {\r\n    if (user.role !== \"SHOP\") return NextResponse.redirect(new URL(\"/\", req.url));\r\n\r\n    // VALIDATE SHOP EXISTS IN DB\r\n    const shopExists = await prisma.shop.findUnique({\r\n      where: { id: requestedShopId }\r\n    });\r\n\r\n    if (!shopExists) {\r\n      return NextResponse.redirect(new URL(\"/\", req.url)); // invalid shop id\r\n    }\r\n\r\n    // Validate shop ownership\r\n    if (!user.shopIds?.includes(requestedShopId)) {\r\n      return NextResponse.redirect(new URL(\"/\", req.url));\r\n    }\r\n\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // PROTECT SHOP API\r\n  if (isShopApi) {\r\n    if (user.role !== \"SHOP\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n    return NextResponse.next();\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\"/((?!_next|static|favicon.ico|images).*)\"],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AACA,+MAAuC,wBAAwB;;;;AAExD,eAAe,WAAW,GAAG;IAClC,MAAM,WAAW,IAAI,OAAO,CAAC,QAAQ;IAErC,8BAA8B;IAC9B,MAAM,YAAY,SAAS,KAAK,CAAC;IACjC,MAAM,kBAAkB,WAAW,CAAC,EAAE,IAAI;IAE1C,MAAM,eAAe,SAAS,UAAU,CAAC;IACzC,MAAM,cAAe,QAAQ;IAC7B,MAAM,aAAe,SAAS,UAAU,CAAC;IACzC,MAAM,YAAe,SAAS,UAAU,CAAC;IAEzC,2CAA2C;IAC3C,MAAM,YAAY,gBAAgB,eAAe,cAAc;IAC/D,IAAI,CAAC,WAAW,OAAO,gMAAY,CAAC,IAAI;IAExC,aAAa;IACb,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU;IACxC,IAAI,CAAC,OAAO,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,IAAI,GAAG;IAEvE,IAAI;IACJ,IAAI;QACF,OAAO,wJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;IACjD,EAAE,OAAM;QACN,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,eAAe,IAAI,GAAG;IAC7D;IAEA,qBAAqB;IACrB,IAAI,gBAAgB,YAAY;QAC9B,IAAI,KAAK,IAAI,KAAK,SAAS,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;QAC5E,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,6CAA6C;IAC7C,IAAI,aAAa;QACf,IAAI,KAAK,IAAI,KAAK,QAAQ,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;QAE3E,6BAA6B;QAC7B,MAAM,aAAa,MAAM,+HAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YAC9C,OAAO;gBAAE,IAAI;YAAgB;QAC/B;QAEA,IAAI,CAAC,YAAY;YACf,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG,IAAI,kBAAkB;QACzE;QAEA,0BAA0B;QAC1B,IAAI,CAAC,KAAK,OAAO,EAAE,SAAS,kBAAkB;YAC5C,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;QACnD;QAEA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,mBAAmB;IACnB,IAAI,WAAW;QACb,IAAI,KAAK,IAAI,KAAK,QAAQ;YACxB,OAAO,gMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QACjE;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;KAA2C;AACvD"}}]
}