{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'stream')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`stream`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/ (unsupported edge import 'crypto')"],"sourcesContent":["__turbopack_context__.n(__import_unsupported(`crypto`));\n"],"names":[],"mappings":"AAAA,sBAAsB,CAAC,CAAC,qBAAqB,CAAC,MAAM,CAAC"}},
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\nexport async function middleware(req) {\r\n  const pathname = req.nextUrl.pathname;\r\n\r\n  // -----------------------------\r\n  // 1️⃣ Detect routes\r\n  // -----------------------------\r\n\r\n  // Any /shop/... url\r\n  const isShopPath = pathname.startsWith(\"/shop/\");\r\n\r\n  // Valid shopId format: /shop/shop_xxxxx\r\n  const shopMatch = pathname.match(/^\\/shop\\/(shop_[A-Za-z0-9]+)/);\r\n  const requestedShopId = shopMatch?.[1] || null;\r\n  const isValidShopIdFormat = Boolean(requestedShopId);\r\n\r\n  const isAdminRoute = pathname.startsWith(\"/admin\");\r\n  const isShopApi = pathname.startsWith(\"/api/shop\");\r\n  const isAdminApi = pathname.startsWith(\"/api/admin\");\r\n\r\n  // Any private route (requires auth)\r\n  const isPrivate = isShopPath || isAdminRoute || isShopApi || isAdminApi;\r\n\r\n  // Public route → go through\r\n  if (!isPrivate) {\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // -----------------------------\r\n  // 2️⃣ Auth check (JWT cookie)\r\n  // -----------------------------\r\n  const token = req.cookies.get(\"token\")?.value;\r\n  if (!token) {\r\n    return NextResponse.redirect(new URL(\"/login\", req.url)); // your login is in (auth)/login → /login\r\n  }\r\n\r\n\r\n  let user;\r\n  try {\r\n    user = jwt.verify(token, process.env.JWT_SECRET);\r\n  } catch(err) {\r\n    console.log('token', err)\r\n    return NextResponse.redirect(new URL(\"/login\", req.url));\r\n  }\r\n\r\n  // -----------------------------\r\n  // 3️⃣ Admin protection\r\n  // -----------------------------\r\n  if (isAdminRoute || isAdminApi) {\r\n    if (user.role !== \"ADMIN\") {\r\n      return NextResponse.redirect(new URL(\"/\", req.url));\r\n    }\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // -----------------------------\r\n  // 4️⃣ SHOP pages protection\r\n  // -----------------------------\r\n  if (isShopPath) {\r\n    // must be SHOP user\r\n    if (user.role !== \"SHOP\") {\r\n      return NextResponse.redirect(new URL(\"/\", req.url));\r\n    }\r\n\r\n    // ❗ If /shop/** BUT id is NOT in \"shop_...\" format → INVALID → redirect home\r\n    if (!isValidShopIdFormat) {\r\n      return NextResponse.redirect(new URL(\"/\", req.url));\r\n    }\r\n\r\n    // Optional: shop ownership check if you added shopIds to JWT\r\n    if (user.shopIds && !user.shopIds.includes(requestedShopId)) {\r\n      return NextResponse.redirect(new URL(\"/\", req.url));\r\n    }\r\n\r\n    return NextResponse.next();\r\n  }\r\n\r\n  // -----------------------------\r\n  // 5️⃣ SHOP API\r\n  // -----------------------------\r\n  if (isShopApi) {\r\n    if (user.role !== \"SHOP\") {\r\n      return NextResponse.json({ error: \"Forbidden\" }, { status: 403 });\r\n    }\r\n    return NextResponse.next();\r\n  }\r\n\r\n  return NextResponse.next();\r\n}\r\n\r\n// apply to all pages except static files\r\nexport const config = {\r\n  matcher: [\"/((?!_next|.*\\\\..*).*)\"],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEO,eAAe,WAAW,GAAG;IAClC,MAAM,WAAW,IAAI,OAAO,CAAC,QAAQ;IAErC,gCAAgC;IAChC,oBAAoB;IACpB,gCAAgC;IAEhC,oBAAoB;IACpB,MAAM,aAAa,SAAS,UAAU,CAAC;IAEvC,wCAAwC;IACxC,MAAM,YAAY,SAAS,KAAK,CAAC;IACjC,MAAM,kBAAkB,WAAW,CAAC,EAAE,IAAI;IAC1C,MAAM,sBAAsB,QAAQ;IAEpC,MAAM,eAAe,SAAS,UAAU,CAAC;IACzC,MAAM,YAAY,SAAS,UAAU,CAAC;IACtC,MAAM,aAAa,SAAS,UAAU,CAAC;IAEvC,oCAAoC;IACpC,MAAM,YAAY,cAAc,gBAAgB,aAAa;IAE7D,4BAA4B;IAC5B,IAAI,CAAC,WAAW;QACd,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,gCAAgC;IAChC,8BAA8B;IAC9B,gCAAgC;IAChC,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,UAAU;IACxC,IAAI,CAAC,OAAO;QACV,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG,IAAI,yCAAyC;IACrG;IAGA,IAAI;IACJ,IAAI;QACF,OAAO,wJAAG,CAAC,MAAM,CAAC,OAAO,QAAQ,GAAG,CAAC,UAAU;IACjD,EAAE,OAAM,KAAK;QACX,QAAQ,GAAG,CAAC,SAAS;QACrB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,IAAI,GAAG;IACxD;IAEA,gCAAgC;IAChC,uBAAuB;IACvB,gCAAgC;IAChC,IAAI,gBAAgB,YAAY;QAC9B,IAAI,KAAK,IAAI,KAAK,SAAS;YACzB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;QACnD;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,gCAAgC;IAChC,4BAA4B;IAC5B,gCAAgC;IAChC,IAAI,YAAY;QACd,oBAAoB;QACpB,IAAI,KAAK,IAAI,KAAK,QAAQ;YACxB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;QACnD;QAEA,6EAA6E;QAC7E,IAAI,CAAC,qBAAqB;YACxB,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;QACnD;QAEA,6DAA6D;QAC7D,IAAI,KAAK,OAAO,IAAI,CAAC,KAAK,OAAO,CAAC,QAAQ,CAAC,kBAAkB;YAC3D,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG;QACnD;QAEA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,gCAAgC;IAChC,eAAe;IACf,gCAAgC;IAChC,IAAI,WAAW;QACb,IAAI,KAAK,IAAI,KAAK,QAAQ;YACxB,OAAO,gMAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAY,GAAG;gBAAE,QAAQ;YAAI;QACjE;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAGO,MAAM,SAAS;IACpB,SAAS;QAAC;KAAyB;AACrC"}}]
}